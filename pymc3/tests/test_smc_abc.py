from pymc3.step_methods.smc_ABC import calc_weights
import numpy as np

def test_calc_weights():
    manual_weights = {'un_weights' : np.array([ 0.73436626, -0.56276323,  0.21854167, -0.07060466, -0.57879688,
       -0.35802561, -0.49446829,  0.48572922, -0.21314636,  0.44139347,
       -0.29315761,  0.3299753 , -0.29315761,  0.73436626, -0.52796797,
       -0.35366049, -0.35366049, -0.29315761,  0.5854393 , -0.45179414,
       -0.21314636,  0.21854167, -0.29315761,  0.44139347,  0.5287131 ,
       -0.45179414, -0.35366049, -0.17412946,  0.06570384, -0.45179414,
        0.09203651,  0.06835008,  0.44139347, -0.35802561, -0.21314636,
       -0.35366049,  0.5854393   ,  0.06835008, -0.52276034, -0.07060466,
        0.04769021,  0.06570384,  0.70537525,  0.05210044, -0.54092975,
       -0.29315761, -0.56276323,  0.70537525, -0.45179414,  0.04769021,
       -0.53613035, -0.44707636,  0.06835008,  0.06835008,  0.5287131 ,
       -0.52796797,  0.32654757, -0.45179414, -0.29074332,  0.73436626,
       -0.49446829, -0.50420503, -0.57879688, -0.41661465,  0.21854167,
        0.32654757,  0.73206403, -0.50420503,  0.32654757,  0.70537525,
       -0.26579978, -0.1667296 , -0.44707636, -0.52796797, -0.26579978,
        0.51947674,  0.73206403,  0.06835008, -0.40397337, -0.56544993,
        0.09203651,  0.73436626, -0.21314636, -0.53613035, -0.39463241,
        0.5287131 , -0.07060466,  0.09203651,  0.5287131 , -0.21314636,
        0.51947674, -0.56544993, -0.07060466,  0.04769021,  0.44139347,
        0.06835008, -0.45179414,  0.44139347, -0.07060466,  0.70537525]),
'weights' : np.array([ 0.01953168,  0.0053383 ,  0.01166057,  0.00873263,  0.00525339,
        0.00655118,  0.00571562,  0.01523203,  0.00757251,  0.01457146,
        0.00699023,  0.01303511,  0.00699023,  0.01953168,  0.00552732,
        0.00657984,  0.00657984,  0.00699023,  0.01682912,  0.00596481,
        0.00757251,  0.01166057,  0.00699023,  0.01457146,  0.01590104,
        0.00596481,  0.00657984,  0.00787381,  0.0100079 ,  0.00596481,
        0.01027494,  0.01003442,  0.01457146,  0.00655118,  0.00757251,
        0.00657984,  0.01682912,  0.01003442,  0.00555618,  0.00873263,
        0.00982924,  0.0100079 ,  0.01897356,  0.00987268,  0.00545614,
        0.00699023,  0.0053383 ,  0.01897356,  0.00596481,  0.00982924,
        0.00548239,  0.00599302,  0.01003442,  0.01003442,  0.01590104,
        0.00552732,  0.01299051,  0.00596481,  0.00700713,  0.01953168,
        0.00571562,  0.00566024,  0.00525339,  0.00617838,  0.01166057,
        0.01299051,  0.01948676,  0.00566024,  0.01299051,  0.01897356,
        0.00718411,  0.00793229,  0.00599302,  0.00552732,  0.00718411,
        0.01575485,  0.01948676,  0.01003442,  0.00625698,  0.00532398,
        0.01027494,  0.01953168,  0.00757251,  0.00548239,  0.0063157 ,
        0.01590104,  0.00873263,  0.01027494,  0.01590104,  0.00757251,
        0.01575485,  0.00532398,  0.00873263,  0.00982924,  0.01457146,
        0.01003442,  0.00596481,  0.01457146,  0.00873263,  0.01897356])}

    np.testing.assert_array_almost_equal(calc_weights(manual_weights['un_weights']), manual_weights['weights'])